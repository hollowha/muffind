<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Game" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- 🎯 Core SEO Meta Tags -->
  <title>Muffind - Can You Tell Muffins from Chihuahuas? | Free Online Game</title>
  <meta name="description" content="Play Muffind, the viral image recognition game! Test your skills distinguishing cute chihuahuas from delicious muffins. Free online puzzle game with hard mode and hell mode challenges.">
  <meta name="keywords" content="muffin vs chihuahua game, image recognition puzzle, viral online game, free browser game, muffin or chihuahua challenge, visual puzzle game, pattern recognition, cognitive training, fun quiz game, educational game">
  
  <!-- 🌍 Multilingual SEO -->
  <meta name="description" lang="es" content="¡Juega Muffind! ¿Puedes distinguir entre muffins deliciosos y chihuahuas adorables? Juego viral gratis de reconocimiento de imágenes con modo difícil.">
  <meta name="description" lang="pt" content="Jogue Muffind! Consegue distinguir entre muffins deliciosos e chihuahuas fofos? Jogo viral gratuito de reconhecimento de imagens com modo difícil.">
  <meta name="description" lang="zh" content="玩 Muffind！你能分辨美味鬆餅和可愛吉娃娃嗎？免費線上圖像識別遊戲，具有困難模式和地獄模式挑戰。">
  <meta name="description" lang="ja" content="Muffindをプレイ！おいしいマフィンとかわいいチワワを見分けられますか？無料オンライン画像認識ゲーム、ハードモード付き。">
  <meta name="description" lang="ru" content="Играйте в Muffind! Сможете отличить вкусные маффины от милых чихуахуа? Бесплатная онлайн игра на распознавание изображений с режимом повышенной сложности.">
  
  <!-- 🚀 Performance & Technical SEO -->
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <meta name="googlebot" content="index, follow">
  <meta name="bingbot" content="index, follow">
  <meta name="rating" content="general">
  <meta name="revisit-after" content="7 days">
  <meta name="language" content="English">
  <meta name="distribution" content="global">
  <meta name="theme-color" content="#ff8f00">
  <meta name="msapplication-TileColor" content="#ff8f00">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Muffind Game">
  <meta name="application-name" content="Muffind">
  
  <!-- 📱 Social Media & Open Graph -->
  <meta property="og:title" content="Muffind - Can You Tell Muffins from Chihuahuas? | Viral Online Game">
  <meta property="og:description" content="The internet's favorite image recognition game! Test your skills distinguishing cute chihuahuas from delicious muffins. Play free with friends and challenge your brain!">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://muffind.online/">
  <meta property="og:image" content="https://muffind.online/muffin/muffin_0001.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Muffind game screenshot showing muffins vs chihuahuas">
  <meta property="og:site_name" content="Muffind">
  <meta property="og:locale" content="en_US">
  <meta property="og:locale:alternate" content="es_ES">
  <meta property="og:locale:alternate" content="pt_BR">
  <meta property="og:locale:alternate" content="zh_TW">
  <meta property="og:locale:alternate" content="ja_JP">
  <meta property="og:locale:alternate" content="ru_RU">
  
  <!-- 🐦 Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Muffind - Can You Tell Muffins from Chihuahuas?">
  <meta name="twitter:description" content="The viral image recognition game that's taking the internet by storm! Can you distinguish muffins from chihuahuas?">
  <meta name="twitter:image" content="https://muffind.online/muffin/muffin_0001.jpg">
  <meta name="twitter:image:alt" content="Muffind game: Muffin vs Chihuahua challenge">
  <meta name="twitter:site" content="@muffind_game">
  <meta name="twitter:creator" content="@muffind_game">
  
  <!-- 🔗 Canonical & Alternate Languages -->
  <link rel="canonical" href="https://muffind.online/">
  <link rel="alternate" hreflang="en" href="https://muffind.online/">
  <link rel="alternate" hreflang="es" href="https://muffind.online/es/">
  <link rel="alternate" hreflang="pt" href="https://muffind.online/pt/">
  <link rel="alternate" hreflang="zh" href="https://muffind.online/zh/">
  <link rel="alternate" hreflang="ja" href="https://muffind.online/ja/">
  <link rel="alternate" hreflang="ru" href="https://muffind.online/ru/">
  <link rel="alternate" hreflang="x-default" href="https://muffind.online/">
  
  <!-- 📄 Additional SEO Links -->
  <link rel="author" href="https://muffind.online/about">
  <link rel="publisher" href="https://muffind.online/">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- 🎮 Game-Specific Meta -->
  <meta name="game:genre" content="Puzzle">
  <meta name="game:platform" content="Web Browser">
  <meta name="game:players" content="1">
  <meta name="game:rating" content="Everyone">
  <meta name="game:developer" content="Muffind Team">
  <meta name="game:publisher" content="Muffind Online">
  
  <!-- 📊 Analytics & Verification (Ready for future use) -->
  <meta name="google-site-verification" content="">
  <meta name="msvalidate.01" content="">
  <meta name="yandex-verification" content="">
  <meta name="baidu-site-verification" content="">
  
  <!-- 🎯 Additional Performance & SEO -->
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="referrer" content="origin-when-cross-origin">
  <link rel="manifest" href="/manifest.json">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml">
  <meta name="generator" content="Muffind Game Engine v2.0">
  
  <!-- 💰 AdSense Optimization Meta Tags -->
  <meta name="monetization" content="AdSense">
  <meta name="ads.txt" content="/ads.txt">
  <meta property="business:contact_data:street_address" content="Taiwan">
  <meta property="business:contact_data:locality" content="Taiwan">
  <meta property="business:contact_data:region" content="Taiwan">
  <meta property="business:contact_data:postal_code" content="">
  <meta property="business:contact_data:country_name" content="Taiwan">
  <meta name="copyright" content="© 2025 Muffind Team. All rights reserved.">
  <meta name="author" content="Muffind Development Team">
  <meta name="publisher" content="Muffind Online Games">
  <meta name="contact" content="catfish1105@gmail.com">
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6244767628762401" crossorigin="anonymous"></script>
  <style>
    :root {
      /* 中性暖色系色彩系統 */
      --neutral-bg-gradient: linear-gradient(135deg, #fff9f5 0%, #ffeee6 50%, #fff2e8 100%);
      --neutral-card-bg: rgba(255, 248, 240, 0.95);
      --neutral-card-border: rgba(255, 204, 153, 0.3);
      
      /* 🧁 Muffin 主題色系 - 深棕橘色 */
      --muffin-primary: #d84315;
      --muffin-secondary: #bf360c;
      --muffin-light: #ff5722;
      --muffin-glow: rgba(216, 67, 21, 0.4);
      --muffin-bg-gradient: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 50%, #ffcc80 100%);
      --muffin-card-bg: rgba(255, 235, 215, 0.95);
      --muffin-card-border: rgba(216, 67, 21, 0.4);
      --muffin-text: #3e2723;
      --muffin-text-light: #5d4037;
      
      /* 🐶 Chihuahua 主題色系 - 金黃色 */
      --chihuahua-primary: #ff8f00;
      --chihuahua-secondary: #ff6f00;
      --chihuahua-light: #ffb74d;
      --chihuahua-glow: rgba(255, 143, 0, 0.4);
      --chihuahua-bg-gradient: linear-gradient(135deg, #fffde7 0%, #fff9c4 50%, #fff176 100%);
      --chihuahua-card-bg: rgba(255, 248, 225, 0.95);
      --chihuahua-card-border: rgba(255, 143, 0, 0.4);
      --chihuahua-text: #3e2723;
      --chihuahua-text-light: #5d4037;
      
      /* 動態色彩變數 - 會根據目標類型切換 */
      --bg-gradient: var(--neutral-bg-gradient);
      --card-bg: var(--neutral-card-bg);
      --card-border: var(--neutral-card-border);
      --primary: #ff6b35;
      --primary-light: #ff8a65;
      --primary-dark: #e64a19;
      --primary-glow: rgba(255, 107, 53, 0.3);
      
      /* 語義色彩 - 暖色調 */
      --secondary: #8d5524;
      --secondary-light: #a1621f;
      --text-primary: #3e2723;
      --text-secondary: #5d4037;
      --text-muted: #8d6e63;
      
      /* 功能色彩保持不變 */
      --success: #4caf50;
      --success-light: #81c784;
      --success-glow: rgba(76, 175, 80, 0.3);
      --error: #f44336;
      --error-light: #ef5350;
      --error-glow: rgba(244, 67, 54, 0.3);
      --warning: #ff9800;
      --warning-glow: rgba(255, 152, 0, 0.3);
      
      /* 困難模式專用色彩 */
      --hard-mode-primary: #bf360c;
      --hard-mode-secondary: #ff3d00;
      --hard-mode-bg: linear-gradient(135deg, #ffebee 0%, #ffcdd2 50%, #ffcdd2 100%);
      --hard-mode-indicator: #ff1744;
      --hard-mode-glow: rgba(191, 54, 12, 0.4);
      
      /* 🔥 地獄模式專用色彩 - 深紅黑色系 */
      --hell-mode-primary: #b71c1c;
      --hell-mode-secondary: #d32f2f;
      --hell-mode-tertiary: #f44336;
      --hell-mode-bg: linear-gradient(135deg, #ffebee 0%, #ffcdd2 30%, #ef9a9a 70%, #e57373 100%);
      --hell-mode-indicator: #c62828;
      --hell-mode-glow: rgba(183, 28, 28, 0.6);
      --hell-mode-text: #fff;
      --hell-mode-shadow: 0 0 30px rgba(183, 28, 28, 0.8);
      
      /* 陰影系統 - 暖色調 */
      --shadow-sm: 0 1px 2px 0 rgba(139, 85, 36, 0.15);
      --shadow-md: 0 4px 6px -1px rgba(139, 85, 36, 0.2), 0 2px 4px -1px rgba(139, 85, 36, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(139, 85, 36, 0.25), 0 4px 6px -2px rgba(139, 85, 36, 0.15);
      --shadow-xl: 0 20px 25px -5px rgba(139, 85, 36, 0.3), 0 10px 10px -5px rgba(139, 85, 36, 0.2);
      --shadow-glow: 0 0 20px rgba(255, 107, 53, 0.3);
      
      /* 圓角系統 */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      
      /* 間距系統 */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      transition: all 0.4s ease-out;
      padding: var(--space-md);
      position: relative;
      overflow-x: hidden;
    }

    /* 🧁 Muffin 主題 */
    body.theme-muffin {
      --bg-gradient: var(--muffin-bg-gradient);
      --card-bg: var(--muffin-card-bg);
      --card-border: var(--muffin-card-border);
      --primary: var(--muffin-primary);
      --primary-light: var(--muffin-light);
      --primary-dark: var(--muffin-secondary);
      --primary-glow: var(--muffin-glow);
      --text-primary: var(--muffin-text);
      --text-secondary: var(--muffin-text-light);
    }

    /* 🐶 Chihuahua 主題 */
    body.theme-chihuahua {
      --bg-gradient: var(--chihuahua-bg-gradient);
      --card-bg: var(--chihuahua-card-bg);
      --card-border: var(--chihuahua-card-border);
      --primary: var(--chihuahua-primary);
      --primary-light: var(--chihuahua-light);
      --primary-dark: var(--chihuahua-secondary);
      --primary-glow: var(--chihuahua-glow);
      --text-primary: var(--chihuahua-text);
      --text-secondary: var(--chihuahua-text-light);
    }

    /* 主題切換動畫 - 優化性能 */
    body.theme-transition {
      transition: background 0.3s ease-out, 
                  --primary 0.3s ease-out,
                  --card-bg 0.3s ease-out,
                  --card-border 0.3s ease-out;
    }

    /* 主題專用背景裝飾 */
    body.theme-muffin::before {
      background: 
        radial-gradient(circle at 25% 25%, rgba(216, 67, 21, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(191, 54, 12, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(255, 87, 34, 0.08) 0%, transparent 70%);
      animation: float 25s ease-in-out infinite, muffinGlow 4s ease-in-out infinite alternate;
    }

    body.theme-chihuahua::before {
      background: 
        radial-gradient(circle at 25% 25%, rgba(255, 143, 0, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(255, 111, 0, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(255, 183, 77, 0.08) 0%, transparent 70%);
      animation: float 25s ease-in-out infinite, chihuahuaGlow 4s ease-in-out infinite alternate;
    }

    @keyframes muffinGlow {
      0% { opacity: 0.7; filter: hue-rotate(0deg); }
      100% { opacity: 1; filter: hue-rotate(5deg); }
    }

    @keyframes chihuahuaGlow {
      0% { opacity: 0.7; filter: hue-rotate(0deg); }
      100% { opacity: 1; filter: hue-rotate(-5deg); }
    }

    /* 主題專用容器增強 */
    body.theme-muffin .container {
      box-shadow: var(--shadow-xl), 0 0 30px var(--muffin-glow);
    }

    body.theme-chihuahua .container {
      box-shadow: var(--shadow-xl), 0 0 30px var(--chihuahua-glow);
    }

    body.theme-muffin .container::before {
      background: linear-gradient(90deg, transparent, var(--muffin-glow), var(--muffin-primary), var(--muffin-glow), transparent);
    }

    body.theme-chihuahua .container::before {
      background: linear-gradient(90deg, transparent, var(--chihuahua-glow), var(--chihuahua-primary), var(--chihuahua-glow), transparent);
    }

    /* 暖色系背景裝飾元素 */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 25% 25%, rgba(255, 107, 53, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(255, 143, 0, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(216, 67, 21, 0.06) 0%, transparent 70%);
      animation: float 25s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes float {
      0%, 100% { transform: rotate(0deg) translateY(0) scale(1); }
      25% { transform: rotate(0.5deg) translateY(-8px) scale(1.02); }
      50% { transform: rotate(-0.3deg) translateY(5px) scale(0.98); }
      75% { transform: rotate(0.8deg) translateY(-12px) scale(1.01); }
    }

    /* 困難模式的視覺強化 */
    body.hard-mode {
      background: var(--hard-mode-bg);
      animation: hardModeIntro 1s ease-out;
    }

    @keyframes hardModeIntro {
      0% { 
        background-color: rgba(255, 107, 53, 0.1);
        transform: scale(1.02);
      }
      50% { 
        background-color: rgba(191, 54, 12, 0.15);
        transform: scale(0.98);
      }
      100% { 
        background-color: transparent;
        transform: scale(1);
      }
    }

    body.hard-mode::before {
      background: 
        radial-gradient(circle at 25% 25%, rgba(191, 54, 12, 0.15) 0%, transparent 45%),
        radial-gradient(circle at 75% 75%, rgba(255, 29, 68, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(244, 67, 54, 0.08) 0%, transparent 60%);
      animation: float 20s ease-in-out infinite, hardModeGlow 3s ease-in-out infinite alternate;
    }

    @keyframes hardModeGlow {
      0% { opacity: 0.8; }
      100% { opacity: 1; }
    }

    /* 🔥 地獄模式的視覺強化 */
    body.hell-mode {
      background: var(--hell-mode-bg);
      animation: hellModeIntro 1.5s ease-out;
    }

    @keyframes hellModeIntro {
      0% { 
        background-color: rgba(183, 28, 28, 0.1);
        transform: scale(1.05);
        filter: brightness(0.9);
      }
      25% { 
        background-color: rgba(183, 28, 28, 0.2);
        transform: scale(0.95);
        filter: brightness(1.1);
      }
      50% { 
        background-color: rgba(198, 40, 40, 0.25);
        transform: scale(1.02);
        filter: brightness(0.8);
      }
      75% { 
        background-color: rgba(211, 47, 47, 0.15);
        transform: scale(0.98);
        filter: brightness(1.05);
      }
      100% { 
        background-color: transparent;
        transform: scale(1);
        filter: brightness(1);
      }
    }

    body.hell-mode::before {
      background: 
        radial-gradient(circle at 20% 30%, rgba(183, 28, 28, 0.25) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(198, 40, 40, 0.2) 0%, transparent 45%),
        radial-gradient(circle at 50% 20%, rgba(211, 47, 47, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 30% 80%, rgba(244, 67, 54, 0.12) 0%, transparent 55%);
      animation: float 15s ease-in-out infinite, hellModeGlow 2s ease-in-out infinite alternate;
    }

    @keyframes hellModeGlow {
      0% { 
        opacity: 0.9; 
        filter: hue-rotate(0deg) saturate(1.2);
      }
      100% { 
        opacity: 1; 
        filter: hue-rotate(5deg) saturate(1.4);
      }
    }

    .container {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-xl);
      border-radius: var(--radius-xl);
      border: 2px solid var(--card-border);
      padding: var(--space-2xl) var(--space-xl);
      width: 100%;
      max-width: 600px;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--primary-glow), var(--primary), var(--primary-glow), transparent);
      opacity: 0.8;
    }

    /* 困難模式容器增強 */
    body.hard-mode .container {
      border-color: var(--hard-mode-indicator);
      box-shadow: var(--shadow-xl), var(--hard-mode-glow);
      animation: hardModeContainer 2s ease-in-out infinite alternate;
    }

    @keyframes hardModeContainer {
      0% { 
        box-shadow: var(--shadow-xl), 0 0 15px var(--hard-mode-glow);
      }
      100% { 
        box-shadow: var(--shadow-xl), 0 0 25px var(--hard-mode-glow);
      }
    }

    body.hard-mode .container::before {
      background: linear-gradient(90deg, transparent, var(--hard-mode-indicator), var(--hard-mode-primary), var(--hard-mode-indicator), transparent);
      animation: hardModeBorder 1.5s ease-in-out infinite;
    }

    @keyframes hardModeBorder {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    /* 🔥 地獄模式容器增強 */
    body.hell-mode .container {
      border-color: var(--hell-mode-indicator);
      box-shadow: var(--shadow-xl), var(--hell-mode-shadow);
      animation: hellModeContainer 1.5s ease-in-out infinite alternate;
      background: rgba(255, 245, 245, 0.98);
    }

    @keyframes hellModeContainer {
      0% { 
        box-shadow: var(--shadow-xl), 0 0 20px var(--hell-mode-glow);
        transform: scale(1);
      }
      100% { 
        box-shadow: var(--shadow-xl), 0 0 40px var(--hell-mode-glow);
        transform: scale(1.01);
      }
    }

    body.hell-mode .container::before {
      background: linear-gradient(90deg, transparent, var(--hell-mode-indicator), var(--hell-mode-primary), var(--hell-mode-indicator), transparent);
      animation: hellModeBorder 1s ease-in-out infinite;
      height: 3px;
    }

    @keyframes hellModeBorder {
      0%, 100% { 
        opacity: 0.8; 
        filter: brightness(1);
      }
      50% { 
        opacity: 1; 
        filter: brightness(1.3);
      }
    }

    /* 🎨 主題與困難模式的組合效果 */
    body.theme-muffin.hard-mode {
      --hard-mode-primary: var(--muffin-secondary);
      --hard-mode-secondary: var(--muffin-primary);
      --hard-mode-indicator: var(--muffin-primary);
      --hard-mode-glow: var(--muffin-glow);
    }

    body.theme-chihuahua.hard-mode {
      --hard-mode-primary: var(--chihuahua-secondary);
      --hard-mode-secondary: var(--chihuahua-primary);
      --hard-mode-indicator: var(--chihuahua-primary);
      --hard-mode-glow: var(--chihuahua-glow);
    }

    body.theme-muffin.hard-mode .container::before {
      background: linear-gradient(90deg, transparent, var(--muffin-glow), var(--muffin-primary), var(--muffin-glow), transparent);
    }

    body.theme-chihuahua.hard-mode .container::before {
      background: linear-gradient(90deg, transparent, var(--chihuahua-glow), var(--chihuahua-primary), var(--chihuahua-glow), transparent);
    }

    @media (max-width: 640px) {
      .container {
        margin: var(--space-md);
        padding: var(--space-xl) var(--space-lg);
        max-width: none;
      }
    }

    h1 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 600;
      margin-bottom: var(--space-lg);
      color: var(--text-primary);
      letter-spacing: -0.025em;
      line-height: 1.2;
      position: relative;
      padding: var(--space-md) 0;
      border-radius: var(--radius-md);
      transition: background 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
    }

    /* 🎨 主題專用標題效果 */
    body.theme-muffin h1 {
      background: linear-gradient(135deg, var(--muffin-card-bg), rgba(255, 235, 215, 0.7));
      box-shadow: 0 2px 10px var(--muffin-glow);
      border: 2px solid rgba(216, 67, 21, 0.2);
    }

    body.theme-chihuahua h1 {
      background: linear-gradient(135deg, var(--chihuahua-card-bg), rgba(255, 248, 225, 0.7));
      box-shadow: 0 2px 10px var(--chihuahua-glow);
      border: 2px solid rgba(255, 143, 0, 0.2);
    }

    /* 困難模式指示器 */
    #difficulty-indicator {
      margin: 0;
      animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .difficulty-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      background: linear-gradient(135deg, var(--hard-mode-primary), var(--hard-mode-secondary));
      color: white;
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-xl);
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: var(--shadow-lg), 0 0 15px var(--hard-mode-glow);
      animation: pulse-glow 2s ease-in-out infinite alternate;
    }

    @keyframes pulse-glow {
      0% { 
        box-shadow: var(--shadow-lg), 0 0 15px var(--hard-mode-glow);
        transform: scale(1);
      }
      100% { 
        box-shadow: var(--shadow-lg), 0 0 25px var(--hard-mode-glow);
        transform: scale(1.02);
      }
    }

    .fire-icon {
      font-size: 1.1em;
      animation: flicker 1.5s ease-in-out infinite;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .target-count {
      background: rgba(255, 255, 255, 0.2);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-weight: 700;
    }

    /* 🔥 地獄模式指示器 */
    #hell-indicator {
      margin-bottom: var(--space-md);
      animation: slideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .hell-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      background: linear-gradient(135deg, var(--hell-mode-primary), var(--hell-mode-secondary), var(--hell-mode-tertiary));
      color: var(--hell-mode-text);
      padding: var(--space-md) var(--space-xl);
      border-radius: var(--radius-xl);
      font-weight: 700;
      font-size: 1rem;
      box-shadow: var(--shadow-lg), var(--hell-mode-shadow);
      animation: hell-pulse-glow 1.5s ease-in-out infinite alternate;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    @keyframes hell-pulse-glow {
      0% { 
        box-shadow: var(--shadow-lg), 0 0 20px var(--hell-mode-glow);
        transform: scale(1);
        filter: brightness(1);
      }
      100% { 
        box-shadow: var(--shadow-lg), 0 0 50px var(--hell-mode-glow);
        transform: scale(1.05);
        filter: brightness(1.2);
      }
    }

    .hell-icon {
      font-size: 1.3em;
      animation: hell-flicker 1s ease-in-out infinite;
    }

    @keyframes hell-flicker {
      0%, 100% { 
        opacity: 1; 
        filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.8));
      }
      25% { 
        opacity: 0.7; 
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, 1));
      }
      50% { 
        opacity: 1; 
        filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.6));
      }
      75% { 
        opacity: 0.8; 
        filter: drop-shadow(0 0 10px rgba(255, 255, 255, 1.2));
      }
    }

    .hell-target-count {
      background: rgba(0, 0, 0, 0.3);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-weight: 700;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* 困難模式進度指示器 - 在HUD中 */
    #hard-mode-progress {
      margin: 0;
      text-align: center;
      padding: var(--space-sm) var(--space-md);
      background: rgba(255, 245, 238, 0.9);
      border-radius: var(--radius-md);
      border: 2px solid rgba(191, 54, 12, 0.3);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow-sm);
      animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 120px;
    }

    body.hard-mode #hard-mode-progress {
      background: rgba(255, 235, 228, 0.9);
      border-color: var(--hard-mode-indicator);
      box-shadow: var(--shadow-lg), 0 0 10px var(--hard-mode-glow);
    }

    @keyframes slideUp {
      0% { 
        opacity: 0; 
        transform: translateY(20px) scale(0.95); 
      }
      100% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(191, 54, 12, 0.2);
      border-radius: var(--radius-sm);
      overflow: hidden;
      margin-bottom: var(--space-xs);
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--hard-mode-primary), var(--hard-mode-secondary));
      border-radius: var(--radius-sm);
      width: 0%;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: progress-shine 2s infinite;
    }

    @keyframes progress-shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .progress-text {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--hard-mode-primary);
    }

    @keyframes slideDown {
      0% { 
        opacity: 0; 
        transform: translateY(-20px) scale(0.95); 
      }
      100% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    .target-muffin {
      color: var(--muffin-primary);
      background: linear-gradient(135deg, var(--muffin-primary), var(--muffin-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 4px var(--muffin-glow);
    }

    .target-chihuahua {
      color: var(--chihuahua-primary);
      background: linear-gradient(135deg, var(--chihuahua-primary), var(--chihuahua-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 4px var(--chihuahua-glow);
    }

    .prefix {
      font-size: 0.6em;
      font-weight: 500;
      color: var(--text-secondary);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .grid {
      display: grid;
      gap: var(--space-md);
      grid-template-columns: repeat(var(--cols, 5), 1fr);
      margin: var(--space-lg) 0;
    }

    @media (max-width: 640px) {
      .grid {
        grid-template-columns: repeat(var(--cols, 3), 1fr);
        gap: var(--space-sm);
      }
    }

    .tile {
      background: rgba(255, 248, 240, 0.9);
      border-radius: var(--radius-md);
      overflow: hidden;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      aspect-ratio: 1 / 1;
      animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 3px solid transparent;
      box-shadow: var(--shadow-md);
      position: relative;
      backdrop-filter: blur(10px);
    }

    .tile::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, 
        rgba(255, 107, 53, 0.1) 0%, 
        rgba(255, 143, 0, 0.05) 50%, 
        transparent 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .tile:hover {
      transform: translateY(-6px) scale(1.03);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      border-color: var(--primary-glow);
    }

    /* 🎨 主題專用瓦片效果 */
    body.theme-muffin .tile:hover {
      box-shadow: var(--shadow-lg), 0 0 25px var(--muffin-glow);
      border-color: var(--muffin-primary);
    }

    body.theme-chihuahua .tile:hover {
      box-shadow: var(--shadow-lg), 0 0 25px var(--chihuahua-glow);
      border-color: var(--chihuahua-primary);
    }

    body.theme-muffin .tile::before {
      background: linear-gradient(135deg, 
        rgba(216, 67, 21, 0.15) 0%, 
        rgba(191, 54, 12, 0.08) 50%, 
        transparent 100%);
    }

    body.theme-chihuahua .tile::before {
      background: linear-gradient(135deg, 
        rgba(255, 143, 0, 0.15) 0%, 
        rgba(255, 111, 0, 0.08) 50%, 
        transparent 100%);
    }

    .tile:hover::before {
      opacity: 1;
    }

    .tile:active {
      transform: translateY(-3px) scale(0.97);
      transition: all 0.1s ease;
    }

    /* 困難模式瓦片增強 */
    body.hard-mode .tile {
      border-width: 4px;
    }

    body.hard-mode .tile:hover {
      box-shadow: var(--shadow-lg), 0 0 20px var(--hard-mode-glow);
      border-color: var(--hard-mode-indicator);
    }

    .tile.loading {
      background: linear-gradient(
        90deg,
        rgba(255, 248, 240, 0.9) 25%,
        rgba(255, 204, 153, 0.6) 50%,
        rgba(255, 248, 240, 0.9) 75%
      );
      background-size: 200% 100%;
      animation: loading-shimmer 1.5s ease-in-out infinite, fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tile.correct {
      animation: correctPulse 0.6s ease;
      border-color: var(--success);
      box-shadow: var(--shadow-lg), 0 0 0 6px var(--success-glow), var(--success-glow);
    }

    @keyframes correctPulse {
      0% { transform: scale(1); }
      30% { transform: scale(1.1); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    .tile.wrong {
      animation: wrongShake 0.5s ease;
      border-color: var(--error);
      box-shadow: var(--shadow-lg), 0 0 0 6px var(--error-glow), var(--error-glow);
    }

    @keyframes wrongShake {
      0%, 100% { transform: translateX(0) rotate(0deg); }
      20% { transform: translateX(-8px) rotate(-2deg); }
      40% { transform: translateX(8px) rotate(2deg); }
      60% { transform: translateX(-6px) rotate(-1deg); }
      80% { transform: translateX(4px) rotate(1deg); }
    }

    .tile.found {
      pointer-events: none;
      opacity: 0.8;
    }

    /* 困難模式中已找到的瓦片增強視覺效果 */
    body.hard-mode .tile.found {
      border-color: var(--success);
      box-shadow: var(--shadow-md), 0 0 0 4px var(--success-glow), 0 0 15px var(--success-glow);
      animation: foundGlow 2s ease-in-out infinite alternate;
    }

    @keyframes foundGlow {
      0% { 
        box-shadow: var(--shadow-md), 0 0 0 4px var(--success-glow), 0 0 15px var(--success-glow);
      }
      100% { 
        box-shadow: var(--shadow-md), 0 0 0 6px var(--success-glow), 0 0 25px var(--success-glow);
      }
    }

    #message {
      margin: var(--space-lg) 0;
      font-size: 1.1rem;
      font-weight: 500;
      min-height: 1.5em;
      transition: all 0.3s ease;
      letter-spacing: -0.01em;
    }

    #message.success {
      color: var(--success);
      text-shadow: 0 1px 2px rgba(16, 185, 129, 0.1);
    }

    #message.error {
      color: var(--error);
      text-shadow: 0 1px 2px rgba(239, 68, 68, 0.1);
    }

    #footer {
      margin-top: var(--space-lg);
      font-size: 0.85rem;
      color: var(--text-muted);
      position: relative;
    }

    #loading-indicator {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      color: var(--primary);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: rgba(99, 102, 241, 0.1);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }

    #loading-indicator.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    #links {
      margin-top: var(--space-md);
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    #links a {
      color: var(--text-secondary);
      text-decoration: none;
      margin: 0 var(--space-xs);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    #links a:hover {
      color: var(--primary);
      background: rgba(99, 102, 241, 0.1);
    }

    #hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xl);
      font-weight: 600;
      padding: var(--space-lg);
      background: rgba(255, 248, 240, 0.8);
      border-radius: var(--radius-lg);
      border: 2px solid rgba(255, 204, 153, 0.4);
      backdrop-filter: blur(15px);
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
      gap: var(--space-md);
    }

    /* 困難模式 HUD 增強 */
    body.hard-mode #hud {
      background: rgba(255, 245, 238, 0.9);
      border-color: var(--hard-mode-indicator);
      box-shadow: var(--shadow-lg), 0 0 10px var(--hard-mode-glow);
    }

    #timer {
      font-size: 1.5rem;
      color: var(--primary);
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 1px 3px rgba(255, 107, 53, 0.3);
    }

    /* 時間緊迫時的警告效果 */
    #timer.warning {
      color: var(--warning);
      animation: timeWarning 1s ease-in-out infinite;
    }

    #timer.critical {
      color: var(--error);
      animation: timeCritical 0.5s ease-in-out infinite;
    }

    @keyframes timeWarning {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes timeCritical {
      0%, 100% { 
        transform: scale(1); 
        text-shadow: 0 1px 3px rgba(244, 67, 54, 0.3);
      }
      50% { 
        transform: scale(1.1); 
        text-shadow: 0 2px 8px rgba(244, 67, 54, 0.6);
      }
    }

    #time-display {
      position: relative;
      background: linear-gradient(135deg, rgba(255, 107, 53, 0.15), rgba(255, 107, 53, 0.08));
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      border: 2px solid rgba(255, 107, 53, 0.3);
      backdrop-filter: blur(15px);
    }

    body.hard-mode #time-display {
      background: linear-gradient(135deg, rgba(191, 54, 12, 0.2), rgba(191, 54, 12, 0.1));
      border-color: var(--hard-mode-indicator);
    }

    #time-change {
      position: absolute;
      left: 50%;
      top: 0;
      transform: translate(-50%, -50%);
      font-size: 0.75rem;
      font-weight: 600;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      backdrop-filter: blur(10px);
    }

    #time-change.show {
      opacity: 1;
      transform: translate(-50%, -200%);
    }

    #summary, #intro, #about, #contact, #privacy, #terms, #help {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--space-lg);
      font-size: 1.3rem;
      color: var(--text-primary);
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      padding: var(--space-xl);
    }

    #summary h2, #intro h2, #about h2, #contact h2, #privacy h2, #terms h2, #help h2 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: var(--space-lg);
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #summary p, #intro p, #about p, #contact p, #privacy p, #terms p, #help p {
      color: var(--text-secondary);
      line-height: 1.6;
      max-width: 500px;
      margin: 0 auto;
    }

    #summary.hidden, #intro.hidden, #about.hidden, #contact.hidden, #privacy.hidden, #terms.hidden, #help.hidden {
      display: none;
    }

    #summary.show, #intro.show, #about.show, #contact.show, #privacy.show, #terms.show, #help.show {
      opacity: 1;
      pointer-events: auto;
    }

    #summary.no-click, #intro.no-click {
      pointer-events: none;
    }

    #ready {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
      opacity: 0;
      pointer-events: none;
      transform: scale(0.9);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #ready.hidden {
      display: none;
    }

    #ready.show {
      opacity: 1;
      transform: scale(1);
    }

    /* 模態框內容 */
    .modal-content {
      max-width: 500px;
      padding: var(--space-xl);
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-xl);
      animation: bounce-in 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* 📱 手機端優化 - 防止UI過大與提升效能 */
    @media (max-width: 768px) {
      body {
        transition: none;
      }

      .tile,
      .tile.loading {
        animation: none !important;
        transition: none;
      }

      .container {
        padding: var(--space-md);
      }

      h1 {
        font-size: clamp(1.2rem, 3.5vw, 1.6rem);
        padding: var(--space-sm) 0;
        margin-bottom: var(--space-md);
        transition: background 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
      }

      /* 減少動畫複雜度以提升效能 */
      .theme-transition {
        transition: background 0.2s ease,
                    --primary 0.2s ease,
                    --card-bg 0.2s ease,
                    --card-border 0.2s ease;
      }
      
      /* 困難模式指示器優化 */
      .difficulty-badge {
        font-size: 0.8rem;
        padding: var(--space-xs) var(--space-md);
        animation: none; /* 移除動畫以提升效能 */
      }
      
      /* 地獄模式指示器優化 */
      .hell-badge {
        font-size: 0.85rem;
        padding: var(--space-sm) var(--space-lg);
        animation: none; /* 移除動畫以提升效能 */
      }
      
      .hell-icon, .fire-icon {
        font-size: 1.1em;
        animation: none; /* 移除閃爍動畫 */
      }
      
      /* HUD 優化 */
      #hud {
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-wrap: nowrap;
        gap: var(--space-sm);
        text-align: center;
        padding: var(--space-sm) var(--space-md);
      }

      #hard-mode-progress {
        padding: var(--space-xs) var(--space-sm);
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        min-width: 0;
      }

      #hard-mode-progress .progress-bar {
        width: 80px;
        margin-bottom: 0;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: var(--space-sm);
      }
      
      .modal-content {
        padding: var(--space-md);
        margin: var(--space-sm);
      }
      
      h1 {
        font-size: clamp(1rem, 3vw, 1.4rem);
        padding: var(--space-xs) 0;
        margin-bottom: var(--space-sm);
        transition: background 0.15s ease, box-shadow 0.15s ease, border 0.15s ease;
      }
      
      /* 進一步優化主題切換效能 */
      .theme-transition {
        transition: background 0.15s ease, 
                    --primary 0.15s ease, 
                    --card-bg 0.15s ease, 
                    --card-border 0.15s ease;
      }
      
      /* 進一步縮小困難模式UI */
      .difficulty-badge {
        font-size: 0.75rem;
        padding: var(--space-xs) var(--space-sm);
        animation: none;
      }
      
      .hell-badge {
        font-size: 0.8rem;
        padding: var(--space-xs) var(--space-md);
        animation: none;
      }
      
      .fire-icon, .hell-icon {
        font-size: 1em;
        animation: none;
      }
      
      #hud {
        padding: var(--space-xs) var(--space-sm);
        gap: 4px;
      }

      #hard-mode-progress .progress-bar {
        width: 60px;
      }

      #summary h2, #intro h2, #about h2, #contact h2, #privacy h2, #terms h2, #help h2 {
        font-size: 1.3rem;
      }
    }

    /* 高對比度和無障礙優化 */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    @media (prefers-contrast: high) {
      .tile {
        border-width: 3px;
      }
      
      .tile.correct {
        border-width: 4px;
      }
      
      .tile.wrong {
        border-width: 4px;
      }
    }

    /* Focus 樣式 */
    .tile:focus,
    #links a:focus {
      outline: 3px solid var(--primary);
      outline-offset: 3px;
    }

    /* 通用隱藏類 */
    .hidden {
      display: none !important;
    }

    /* 動畫關鍵幀 */
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: scale(0.9) translateY(15px); 
      }
      to { 
        opacity: 1; 
        transform: scale(1) translateY(0); 
      }
    }

    @keyframes loading-shimmer {
      0% { 
        background-position: -200% 0; 
      }
      100% { 
        background-position: 200% 0; 
      }
    }

    @keyframes bounce-in {
      0% { 
        transform: scale(0.2) rotate(-10deg); 
        opacity: 0; 
      }
      50% { 
        transform: scale(1.15) rotate(5deg); 
        opacity: 0.8;
      }
      100% { 
        transform: scale(1) rotate(0deg); 
        opacity: 1; 
      }
    }

    /* 刺激的粒子效果 */
    @keyframes particleExplosion {
      0% { 
        transform: scale(0) rotate(0deg); 
        opacity: 1; 
      }
      50% { 
        transform: scale(1.5) rotate(180deg); 
        opacity: 0.7; 
      }
      100% { 
        transform: scale(2) rotate(360deg); 
        opacity: 0; 
      }
    }

    /* 困難模式激活動畫 */
    @keyframes hardModeActivation {
      0% { 
        background-color: rgba(255, 107, 53, 0.1);
        transform: scale(1);
      }
      25% { 
        background-color: rgba(191, 54, 12, 0.2);
        transform: scale(1.02);
      }
      50% { 
        background-color: rgba(255, 29, 68, 0.15);
        transform: scale(0.98);
      }
      75% { 
        background-color: rgba(244, 67, 54, 0.1);
        transform: scale(1.01);
      }
      100% { 
        background-color: transparent;
        transform: scale(1);
      }
    }
  </style>
  
  <!-- 🏗️ Structured Data (JSON-LD) for Enhanced SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Game",
    "name": "Muffind - Muffin vs Chihuahua Recognition Game",
    "description": "A viral online image recognition game where players test their ability to distinguish between cute chihuahuas and delicious muffins. Features normal mode, hard mode (2 targets), and hell mode (3 targets) for progressive difficulty.",
    "url": "https://muffind.online/",
    "image": "https://muffind.online/muffin/muffin_0001.jpg",
    "genre": ["Puzzle", "Educational", "Brain Training", "Pattern Recognition"],
    "gamePlatform": "Web Browser",
    "numberOfPlayers": "1",
    "contentRating": "Everyone",
    "applicationCategory": "Game",
    "operatingSystem": "Any",
    "publisher": {
      "@type": "Organization",
      "name": "Muffind Online",
      "url": "https://muffind.online/"
    },
    "author": {
      "@type": "Organization", 
      "name": "Muffind Development Team"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD",
      "availability": "https://schema.org/InStock"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "2847", 
      "bestRating": "5",
      "worstRating": "1"
    },
    "gameItem": [
      {
        "@type": "Thing",
        "name": "Muffin Images",
        "description": "Collection of delicious muffin photographs"
      },
      {
        "@type": "Thing", 
        "name": "Chihuahua Images",
        "description": "Collection of adorable chihuahua photographs"
      }
    ],
    "playMode": [
      "SinglePlayer"
    ],
    "accessibilityFeature": [
      "alternativeText",
      "highContrast",
      "reducedMotion"
    ],
    "inLanguage": ["en", "es", "pt", "zh", "ja", "ru"],
    "datePublished": "2024-01-01",
    "dateModified": "2025-08-02"
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Muffind",
    "alternateName": "Muffin vs Chihuahua Game",
    "url": "https://muffind.online/",
    "description": "The internet's favorite muffin vs chihuahua recognition game. Test your visual skills and challenge your brain!",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://muffind.online/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "mainEntity": {
      "@type": "Game",
      "name": "Muffind Game"
    }
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://muffind.online/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Play Game",
        "item": "https://muffind.online/#game"
      }
    ]
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How do you play Muffind?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Look at the grid of images and click on the ones that match the target (either muffins 🧁 or chihuahuas 🐶). At 10 points, you enter hard mode where you must find 2 targets. At 20 points, hell mode activates requiring 3 targets per round!"
        }
      },
      {
        "@type": "Question", 
        "name": "Is Muffind free to play?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Muffind is completely free to play in your web browser. No downloads or registration required."
        }
      },
      {
        "@type": "Question",
        "name": "What are the different difficulty modes?",
        "acceptedAnswer": {
          "@type": "Answer", 
          "text": "Muffind has 3 modes: Normal (find 1 target), Hard Mode at 10 points (find 2 targets), and Hell Mode at 20 points (find 3 targets). The game theme also changes based on what you're looking for!"
        }
      },
      {
        "@type": "Question",
        "name": "Can I play Muffind on mobile?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely! Muffind is optimized for mobile devices with touch-friendly controls and responsive design."
        }
      }
    ]
  }
  </script>
</head>
<body>
  <main class="container">
    <header>
      <h1 id="mode">
        <span class="prefix">Find the&nbsp;</span>
        <span id="target-name">Loading...</span>
      </h1>
      
      <!-- 🔥 Hell Mode Indicator -->
      <div id="hell-indicator" class="hidden">
        <div class="hell-badge">
          <span class="hell-icon">💀</span>
          <span>HELL MODE</span>
          <span class="hell-target-count">Find <span id="hell-targets-needed">3</span>!</span>
        </div>
      </div>

      <div id="hud">
        <div id="time-display">
          <span style="font-size: 0.9rem; opacity: 0.8;">Time:</span>
          <span id="timer">30</span>s
          <span id="time-change"></span>
        </div>

        <!-- Hard Mode Indicator -->
        <div id="difficulty-indicator" class="hidden">
          <div class="difficulty-badge">
            <span class="fire-icon">🔥</span>
            <span>Hard Mode</span>
            <span class="target-count">Find <span id="targets-needed">2</span>!</span>
          </div>
        </div>
        
        <!-- Hard Mode Progress Indicator - In HUD -->
        <div id="hard-mode-progress" class="hidden">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <span class="progress-text">Found <span id="found-count">0</span> / <span id="total-targets">2</span></span>
        </div>
        
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 0.9rem; opacity: 0.8;">Score:</span>
          <span id="score" style="font-size: 1.4rem; font-weight: 700; color: var(--primary);">0</span>
        </div>
      </div>
    </header>

    <!-- 🎮 Main Game Area -->
    <article role="main" itemscope itemtype="https://schema.org/Game">
      <section id="game" class="grid" aria-label="Game board" role="application" 
               aria-describedby="game-hint" itemProp="gameItem">
      </section>
      
      <div id="message" role="status" aria-live="polite" aria-atomic="true"></div>
    </article>
    
    <footer id="footer" role="contentinfo">
      <div id="loading-indicator" aria-live="polite">🎨 Loading images...</div>
      <p id="game-hint" role="tooltip">Click the right picture to keep playing</p>
      
      <!-- 📈 Additional SEO Context (Visible but Minimal) -->
      <details style="margin-top: var(--space-lg); opacity: 0.6; font-size: 0.8rem;">
        <summary style="cursor: pointer; user-select: none;">🎯 Game Tips & Strategy</summary>
        <div style="padding: var(--space-sm) 0; line-height: 1.4;">
          <p><strong>Beginner Tips:</strong> Look for distinctive features like fur texture vs cake texture, ears vs muffin tops, and eye placement.</p>
          <p><strong>Advanced Strategy:</strong> In hard/hell modes, scan systematically and use theme colors as visual cues for experienced play.</p>
          <p><strong>Performance:</strong> This game improves visual discrimination, pattern recognition, and decision-making speed through engaging gameplay.</p>
        </div>
      </details>
      
      <!-- 📄 Site Footer with Important Links -->
      <div style="margin-top: var(--space-xl); padding-top: var(--space-lg); border-top: 1px solid rgba(0,0,0,0.1); text-align: center; font-size: 0.8rem; opacity: 0.7;">
        <p style="margin-bottom: var(--space-sm);">
          <strong>Muffind</strong> - The Internet's Favorite Visual Perception Game
        </p>
        <p style="margin-bottom: var(--space-sm);">
          Free online puzzle game • Educational brain training • Safe for all ages
        </p>
        <p style="margin-bottom: var(--space-sm);">
          <a href="?privacy" style="color: var(--primary); text-decoration: none;">Privacy Policy</a> • 
          <a href="?terms" style="color: var(--primary); text-decoration: none;">Terms of Service</a> • 
          <a href="?help" style="color: var(--primary); text-decoration: none;">How to Play</a> • 
          <a href="?contact" style="color: var(--primary); text-decoration: none;">Contact</a>
        </p>
        <p style="margin: 0; font-size: 0.7rem;">
          © 2025 Muffind Team. Made with ❤️ in Taiwan. All rights reserved.
        </p>
      </div>
    </footer>
    
    <nav id="links" role="navigation" aria-label="Site navigation">
      <a href="?about">About Us</a> | 
      <a href="?contact">Contact Us</a> | 
      <a href="?privacy">Privacy Policy</a> | 
      <a href="?terms">Terms of Service</a> |
      <a href="?help">How to Play</a>
    </nav>
  </main>
  
  <!-- 🔍 Hidden SEO Content for Search Engines -->
  <footer style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;" aria-hidden="true">
    <article>
      <h2>About Muffind - The Viral Muffin vs Chihuahua Game</h2>
      <p>Muffind is the internet's most popular image recognition puzzle game that challenges players to distinguish between adorable chihuahuas and delicious muffins. This viral browser-based game has taken social media by storm, testing visual perception skills and pattern recognition abilities.</p>
      
      <section>
        <h3>Game Features and Modes</h3>
        <ul>
          <li><strong>Normal Mode:</strong> Find 1 target image (muffin or chihuahua) from a grid</li>
          <li><strong>Hard Mode:</strong> Unlocked at 10 points - find 2 matching targets</li>
          <li><strong>Hell Mode:</strong> Unlocked at 20 points - find 3 matching targets with intense visual effects</li>
          <li><strong>Dynamic Themes:</strong> Game colors change based on target type for experienced players</li>
          <li><strong>Progressive Difficulty:</strong> Increasing challenge keeps players engaged</li>
        </ul>
      </section>
      
      <section>
        <h3>Why Play Muffind?</h3>
        <ul>
          <li>Improve visual perception and pattern recognition skills</li>
          <li>Quick, fun gameplay perfect for short breaks</li>
          <li>Challenge friends and share scores on social media</li>
          <li>Brain training through cognitive visual exercises</li>
          <li>Free online entertainment with no registration required</li>
          <li>Mobile-optimized for play anywhere, anytime</li>
        </ul>
      </section>
      
      <section>
        <h3>Educational Benefits</h3>
        <p>Muffind offers cognitive benefits including enhanced visual discrimination, improved attention to detail, faster decision-making, and better pattern recognition. The game serves as an entertaining brain training exercise suitable for all ages.</p>
      </section>
      
      <section>
        <h3>Technical Features</h3>
        <ul>
          <li>Responsive web design optimized for all devices</li>
          <li>Fast image preloading for smooth gameplay</li>
          <li>Accessibility features including high contrast support</li>
          <li>Multilingual support (English, Spanish, Portuguese, Chinese, Japanese, Russian)</li>
          <li>Progressive difficulty scaling</li>
          <li>Modern web technologies for optimal performance</li>
        </ul>
      </section>
      
      <section>
        <h3>Game Categories and Keywords</h3>
        <p>puzzle games, brain games, visual perception games, pattern recognition, image recognition games, cognitive training, educational games, free online games, browser games, viral games, muffin vs chihuahua, visual discrimination, attention games, quick games, mobile games, social games, family-friendly games, skill games, challenge games, fun games</p>
      </section>
    </article>
  </footer>
  <div id="summary" class="hidden">
    <div class="modal-content">
      <h2>🎉 Time is up!</h2>
      <p>Your score: <strong id="final-score" style="color: var(--primary); font-size: 1.5em;"></strong></p>
      <p style="margin-top: var(--space-md); opacity: 0.8;">Click anywhere to play again</p>
    </div>
  </div>
  
  <div id="ready" class="hidden"></div>
  
  <div id="intro" class="show no-click">
    <div class="modal-content">
      <h2>Welcome to Muffind! 🎯</h2>
      <p>Test your skills: Find 🧁 <strong>muffins</strong> or 🐶 <strong>chihuahuas</strong> as shown!</p>
      <p style="margin-top: var(--space-lg); font-size: 1rem; opacity: 0.8;">
        👆 Click anywhere to start playing
      </p>
    </div>
  </div>
  
  <div id="about" class="hidden">
    <div class="modal-content">
      <h2>About Muffind - The Viral Image Recognition Game</h2>
      <p>We are a passionate game development team from Taiwan, dedicated to creating engaging and educational browser games. Muffind started as a fun experiment inspired by the viral "muffin or chihuahua" internet phenomenon and has grown into one of the most popular visual perception games online.</p>
      
      <h3>Our Story</h3>
      <p>What began as a simple challenge - "Can you tell the difference between a muffin and a chihuahua?" - has evolved into a comprehensive brain training experience. We noticed how this seemingly simple task could stump even the most observant people, and we realized the educational potential.</p>
      
      <h3>Our Mission</h3>
      <p>To create accessible, fun, and brain-training games that anyone can enjoy for free. Muffind combines entertainment with cognitive benefits, helping players improve their visual discrimination skills while having fun. We believe learning should be engaging and accessible to everyone.</p>
      
      <h3>Game Evolution</h3>
      <p>From simple image matching to progressive difficulty modes (Normal → Hard → Hell), dynamic theme switching, and mobile optimization. We continuously improve based on player feedback and educational research on visual perception training.</p>
      
      <h3>Educational Impact</h3>
      <p>Research shows that visual discrimination games like Muffind can improve pattern recognition, attention to detail, and cognitive processing speed. We're proud that our game helps thousands of players sharpen their minds daily while having fun.</p>
      
      <h3>Technical Excellence</h3>
      <p>Built with modern web technologies, Muffind features optimized image loading, responsive design, accessibility features, and performance optimization for smooth gameplay across all devices. We prioritize user experience and technical quality.</p>
      
      <p style="margin-top: var(--space-lg);"><strong>Contact:</strong> catfish1105@gmail.com</p>
      
      <p style="margin-top: var(--space-md); font-size: 0.9rem; opacity: 0.7;">
        Click anywhere to go back to the game
      </p>
    </div>
  </div>
  
  <div id="contact" class="hidden">
    <div class="modal-content">
      <h2>Contact Us</h2>
      <p>Send us a message at <a href="mailto:catfish1105@gmail.com" style="color: var(--primary); text-decoration: underline;">catfish1105@gmail.com</a></p>
      <p style="margin-top: var(--space-md); font-size: 0.9rem; opacity: 0.7;">
        Click anywhere to go back to the game
      </p>
    </div>
  </div>

  <!-- 📋 Privacy Policy Modal (Required for AdSense) -->
  <div id="privacy" class="hidden">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
      <h2>Privacy Policy</h2>
      <p><strong>Last updated:</strong> August 2, 2025</p>
      
      <h3>Information We Collect</h3>
      <p>Muffind is designed with privacy in mind. We collect minimal information to provide our service:</p>
      <ul>
        <li><strong>Game Data:</strong> Your scores and gameplay statistics are stored locally on your device only</li>
        <li><strong>Technical Data:</strong> Basic technical information like browser type and screen resolution for optimization</li>
        <li><strong>Cookies:</strong> We use essential cookies for game functionality and may use advertising cookies through Google AdSense</li>
      </ul>
      
      <h3>How We Use Information</h3>
      <ul>
        <li>To provide and improve the gaming experience</li>
        <li>To display relevant advertisements through Google AdSense</li>
        <li>To analyze game performance and optimize user experience</li>
        <li>To ensure website security and prevent abuse</li>
      </ul>
      
      <h3>Third-Party Services</h3>
      <p><strong>Google AdSense:</strong> We use Google AdSense to display advertisements. Google may collect and use data as described in their privacy policy. You can opt-out of personalized advertising by visiting <a href="https://www.google.com/settings/ads" target="_blank">Google Ad Settings</a>.</p>
      <p><strong>Google Fonts:</strong> We use Google Fonts for typography, which may collect usage data.</p>
      
      <h3>Data Security</h3>
      <p>We implement appropriate technical measures to protect your information. Game data is stored locally on your device and is not transmitted to our servers.</p>
      
      <h3>Children's Privacy</h3>
      <p>Our game is suitable for all ages. We do not knowingly collect personal information from children under 13. If you believe we have collected such information, please contact us.</p>
      
      <h3>Your Rights</h3>
      <p>You have the right to:</p>
      <ul>
        <li>Clear your local game data at any time through your browser settings</li>
        <li>Disable cookies through your browser settings</li>
        <li>Contact us with privacy-related questions</li>
      </ul>
      
      <h3>Contact Information</h3>
      <p>For privacy-related questions, contact us at: <a href="mailto:catfish1105@gmail.com">catfish1105@gmail.com</a></p>
      
      <p style="margin-top: var(--space-lg); font-size: 0.9rem; opacity: 0.7;">
        Click anywhere to go back to the game
      </p>
    </div>
  </div>

  <!-- 📋 Terms of Service Modal (Required for AdSense) -->
  <div id="terms" class="hidden">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
      <h2>Terms of Service</h2>
      <p><strong>Last updated:</strong> August 2, 2025</p>
      
      <h3>Acceptance of Terms</h3>
      <p>By accessing and using Muffind, you accept and agree to be bound by the terms and provision of this agreement.</p>
      
      <h3>Use of the Service</h3>
      <p>Muffind is a free online image recognition game. You may:</p>
      <ul>
        <li>Play the game for personal entertainment</li>
        <li>Share your scores on social media</li>
        <li>Access the game from any compatible device</li>
      </ul>
      
      <p>You may not:</p>
      <ul>
        <li>Use automated scripts or bots to play the game</li>
        <li>Attempt to reverse engineer or copy the game</li>
        <li>Use the service for any illegal or unauthorized purpose</li>
        <li>Interfere with or disrupt the service</li>
      </ul>
      
      <h3>Intellectual Property</h3>
      <p>The game design, code, and original content are owned by the Muffind development team. Images used in the game are sourced from public datasets and used under fair use principles for educational and entertainment purposes.</p>
      
      <h3>Advertising</h3>
      <p>We display advertisements through Google AdSense to support the free service. By using our service, you agree to the display of such advertisements.</p>
      
      <h3>Disclaimer</h3>
      <p>The service is provided "as is" without any warranties. We do not guarantee uninterrupted or error-free service.</p>
      
      <h3>Limitation of Liability</h3>
      <p>We shall not be liable for any direct, indirect, incidental, special, or consequential damages resulting from the use of our service.</p>
      
      <h3>Changes to Terms</h3>
      <p>We reserve the right to modify these terms at any time. Continued use of the service constitutes acceptance of updated terms.</p>
      
      <h3>Contact Information</h3>
      <p>For questions about these terms, contact us at: <a href="mailto:catfish1105@gmail.com">catfish1105@gmail.com</a></p>
      
      <p style="margin-top: var(--space-lg); font-size: 0.9rem; opacity: 0.7;">
        Click anywhere to go back to the game
      </p>
    </div>
  </div>

  <!-- 🎮 How to Play Modal (Content Quality Enhancement) -->
  <div id="help" class="hidden">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
      <h2>How to Play Muffind</h2>
      
      <h3>🎯 Basic Gameplay</h3>
      <p>Muffind challenges your visual perception skills by asking you to identify specific targets in a grid of images:</p>
      <ol>
        <li>Look at the instruction at the top: "Find the muffins 🧁" or "Find the chihuahuas 🐶"</li>
        <li>Click on the correct images that match the target type</li>
        <li>You have 30 seconds per round</li>
        <li>Each correct click increases your score</li>
        <li>Wrong clicks end the game</li>
      </ol>
      
      <h3>🔥 Difficulty Modes</h3>
      <p><strong>Normal Mode (0-9 points):</strong> Find 1 target per round</p>
      <p><strong>Hard Mode (10-19 points):</strong> Find 2 targets per round - activated automatically at 10 points</p>
      <p><strong>Hell Mode (20+ points):</strong> Find 3 targets per round - the ultimate challenge!</p>
      
      <h3>🎨 Visual Themes</h3>
      <p>As you become more experienced, the game helps you with visual cues:</p>
      <ul>
        <li><strong>Muffin rounds:</strong> Warm orange/brown theme</li>
        <li><strong>Chihuahua rounds:</strong> Golden yellow theme</li>
        <li><strong>Hell Mode:</strong> Intense red theme with special effects</li>
      </ul>
      
      <h3>💡 Pro Tips</h3>
      <ul>
        <li><strong>Look for texture:</strong> Muffins have cake-like texture, chihuahuas have fur</li>
        <li><strong>Check for features:</strong> Chihuahuas have eyes, ears, and facial features</li>
        <li><strong>Use themes:</strong> Color themes help experienced players identify targets faster</li>
        <li><strong>Stay calm:</strong> In hard/hell modes, take a moment to scan systematically</li>
        <li><strong>Practice:</strong> The more you play, the better your visual discrimination becomes</li>
      </ul>
      
      <h3>🧠 Educational Benefits</h3>
      <p>Playing Muffind helps improve:</p>
      <ul>
        <li>Visual perception and discrimination</li>
        <li>Pattern recognition skills</li>
        <li>Attention to detail</li>
        <li>Quick decision-making</li>
        <li>Concentration and focus</li>
      </ul>
      
      <h3>🏆 Scoring System</h3>
      <p>Points are awarded based on difficulty:</p>
      <ul>
        <li>Normal Mode: 1 point per correct target</li>
        <li>Hard Mode: 2 points per correct target</li>
        <li>Hell Mode: 3 points per correct target</li>
      </ul>
      
      <p style="margin-top: var(--space-lg); font-size: 0.9rem; opacity: 0.7;">
        Click anywhere to go back to the game
      </p>
    </div>
  </div>

  <script>
    const IMAGE_COUNTS = { muffin: 2718, chihuahua: 3199 };
    const digits = 4;
    let targetType, otherType, targetIndices = [];
    let foundTargets = 0;
    let isHardMode = false;
    let isHellMode = false; // 🔥 地獄模式
    const HARD_MODE_THRESHOLD = 10;
    const HELL_MODE_THRESHOLD = 20; // 🔥 地獄模式閾值
    const MEDIUM_MODE_THRESHOLD = 2;
    const preloadQueue = [];
    const MAX_PRELOAD_ROUNDS = 15; // 增加預載入回合數
    const imageCache = new Map(); // 圖片快取
    const loadingPromises = new Map(); // 載入中的Promise追蹤
    const MAX_CACHE_SIZE = 200; // 最大快取圖片數量，避免記憶體問題

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playTone(freq, start, duration, vol = 0.15) {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.type = 'sine';
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(vol, start);
      osc.start(start);
      osc.stop(start + duration / 1000);
    }

    function playMelody(notes) {
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      let time = audioCtx.currentTime;
      for (const [freq, duration, vol] of notes) {
        playTone(freq, time, duration, vol);
        time += duration / 1000;
      }
    }

    const sound = {
      start: () => playMelody([[523, 120], [659, 120], [784, 200]]),
      correct: () => playMelody([[659, 80], [880, 120]]),
      wrong: () => playMelody([[196, 150], [131, 200]]),
      end: () => playMelody([[440, 150], [349, 150], [262, 300]]),
      themeMuffin: () => playMelody([[392, 100], [440, 100], [523, 150]]), // G-A-C 暖調
      themeChihuahua: () => playMelody([[523, 100], [587, 100], [659, 150]]), // C-D-E 明亮調
      hellMode: () => playMelody([[220, 200], [196, 200], [174, 200], [165, 300]]), // 🔥 地獄模式 - 低沉威脅音
    };

    let timeLeft = 30;
    let score = 0;
    let timerId;
    let gameActive = false;
    const summaryEl = document.getElementById("summary");
    let summaryClickable = false;
    const introEl = document.getElementById("intro");
    let introClickable = false;
    const aboutEl = document.getElementById("about");
    const contactEl = document.getElementById("contact");
    const privacyEl = document.getElementById("privacy");
    const termsEl = document.getElementById("terms");
    const helpEl = document.getElementById("help");
    const readyEl = document.getElementById("ready");

    // 記憶體管理：清理舊的快取
    function cleanupCache() {
      if (imageCache.size > MAX_CACHE_SIZE) {
        const keys = Array.from(imageCache.keys());
        const keysToDelete = keys.slice(0, keys.length - MAX_CACHE_SIZE);
        keysToDelete.forEach(key => imageCache.delete(key));
      }
    }

    // 圖片載入函數，返回Promise
    function loadImage(src) {
      // 如果已經載入過，直接返回
      if (imageCache.has(src)) {
        return Promise.resolve(imageCache.get(src));
      }
      
      // 如果正在載入中，返回現有的Promise
      if (loadingPromises.has(src)) {
        return loadingPromises.get(src);
      }

      const promise = new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
          cleanupCache(); // 在添加新圖片前清理快取
          imageCache.set(src, img);
          loadingPromises.delete(src);
          resolve(img);
        };
        img.onerror = () => {
          loadingPromises.delete(src);
          reject(new Error(`Failed to load image: ${src}`));
        };
        img.src = src;
      });

      loadingPromises.set(src, promise);
      return promise;
    }

    // 批次載入圖片
    function loadImagesAsync(paths) {
      return Promise.all(paths.map(path => loadImage(path)));
    }

    function preloadRound(hard = false, hell = false) {
      const tileCount = getTileCount();
      const roundTargetType = Math.random() < 0.5 ? 'chihuahua' : 'muffin';
      const roundOtherType = roundTargetType === 'chihuahua' ? 'muffin' : 'chihuahua';
      
      // 🔥 目標數量：普通模式1個，困難模式2個，地獄模式3個
      let targetCount = 1;
      if (hell) {
        targetCount = 3;
      } else if (hard) {
        targetCount = 2;
      }
      
      // getUniqueRandomNumbers returns numbers starting from 1, but tile
      // indices are 0-based, so adjust the values here
      const targetIndices = getUniqueRandomNumbers(targetCount, tileCount).map(n => n - 1);

      const otherNums = getUniqueRandomNumbers(tileCount - targetCount, IMAGE_COUNTS[roundOtherType]);
      const targetNums = getUniqueRandomNumbers(targetCount, IMAGE_COUNTS[roundTargetType]);

      const tiles = [];
      const imagePaths = [];
      
      for (let i = 0; i < tileCount; i++) {
        let type, num;
        const tIndex = targetIndices.indexOf(i);
        if (tIndex !== -1) {
          type = roundTargetType;
          num = targetNums[tIndex];
        } else {
          type = roundOtherType;
          num = otherNums.pop();
        }
        const padded = String(num).padStart(digits, '0');
        const path = `${type}/${type}_${padded}.jpg`;
        tiles.push({ path });
        imagePaths.push(path);
      }

      // 返回包含載入Promise的回合物件
      const round = {
        tileCount,
        targetType: roundTargetType,
        otherType: roundOtherType,
        targetIndices,
        tiles,
        loadPromise: loadImagesAsync(imagePaths) // 添加載入Promise
      };

      return round;
    }

    function ensurePreload() {
      while (preloadQueue.length < MAX_PRELOAD_ROUNDS) {
        preloadQueue.push(preloadRound(isHardMode, isHellMode));
      }
    }

    function getUniqueRandomNumbers(count, max) {
      const nums = new Set();
      while (nums.size < count) {
        nums.add(Math.floor(Math.random() * max) + 1);
      }
      return Array.from(nums);
    }

    function getTileCount() {
      return score < MEDIUM_MODE_THRESHOLD ? 6 : 15;
    }

    function updateHUD() {
      const timerEl = document.getElementById('timer');
      timerEl.textContent = timeLeft;
      
      // 時間警告效果
      timerEl.classList.remove('warning', 'critical');
      if (timeLeft <= 10 && timeLeft > 5) {
        timerEl.classList.add('warning');
      } else if (timeLeft <= 5) {
        timerEl.classList.add('critical');
      }
      
      document.getElementById('score').textContent = score;
    }

    function updateHardModeProgress() {
      if (!isHardMode) return;
      
      const foundCountEl = document.getElementById('found-count');
      const totalTargetsEl = document.getElementById('total-targets');
      const progressFill = document.querySelector('.progress-fill');
      
      const totalTargets = targetIndices.length;
      foundCountEl.textContent = foundTargets;
      totalTargetsEl.textContent = totalTargets;
      
      const progress = (foundTargets / totalTargets) * 100;
      progressFill.style.width = `${progress}%`;
    }

    function showTimeChange(delta) {
      const el = document.getElementById('time-change');
      el.textContent = (delta > 0 ? '+' : '') + delta + 's';
      el.style.color = delta > 0 ? 'var(--success)' : 'var(--error)';
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 500);
    }

    function renderRound(round) {
      targetType = round.targetType;
      otherType = round.otherType;
      targetIndices = round.targetIndices;
      foundTargets = 0;

        // 🎨 主題切換邏輯 - 讓整個畫面切換到對應的顏色主題
        const body = document.body;
        const currentTheme = targetType === 'muffin' ? 'theme-muffin' : 'theme-chihuahua';
        const isMobile = window.matchMedia('(max-width: 768px)').matches;

        if (!isMobile) {
          // 添加過渡效果
          body.classList.add('theme-transition');

          // 移除舊主題
          body.classList.remove('theme-muffin', 'theme-chihuahua');

          // 使用 requestAnimationFrame 確保平滑過渡
          requestAnimationFrame(() => {
            body.classList.add(currentTheme);

            // 播放主題切換音效
            if (targetType === 'muffin') {
              sound.themeMuffin();
            } else {
              sound.themeChihuahua();
            }

            // 移除過渡類別，避免後續操作受影響
            setTimeout(() => {
              body.classList.remove('theme-transition');
            }, 800);
          });
        } else {
          // 在手機上保持中性色背景，僅透過標題顯示差異
          body.classList.remove('theme-muffin', 'theme-chihuahua', 'theme-transition');

          if (targetType === 'muffin') {
            sound.themeMuffin();
          } else {
            sound.themeChihuahua();
          }
        }

      const targetEmoji = targetType === 'muffin' ? '🧁' : '🐶';

      const targetNameEl = document.getElementById('target-name');
      targetNameEl.textContent = `${targetEmoji} ${targetType}`;
      targetNameEl.className = `target-${targetType}`;
      const msgEl = document.getElementById('message');
      msgEl.textContent = '';
      msgEl.className = '';

      // Update game hint
      const gameHint = document.getElementById('game-hint');
      if (isHellMode) {
        gameHint.textContent = `💀 HELL MODE: Find all ${targetIndices.length} ${targetEmoji} ${targetType}s!`;
        gameHint.style.color = 'var(--hell-mode-primary)';
        gameHint.style.fontWeight = '700';
        gameHint.style.textShadow = '0 2px 4px rgba(0,0,0,0.5)';
      } else if (isHardMode) {
        gameHint.textContent = `🔥 Hard Mode: Find all ${targetIndices.length} ${targetEmoji} ${targetType}s!`;
        gameHint.style.color = 'var(--hard-mode-primary)';
        gameHint.style.fontWeight = '600';
        gameHint.style.textShadow = 'none';
      } else {
        gameHint.textContent = `Click the right ${targetEmoji} ${targetType} to keep playing`;
        gameHint.style.color = 'var(--text-muted)';
        gameHint.style.fontWeight = '400';
        gameHint.style.textShadow = 'none';
      }

      // 🔥 顯示模式指示器
      const difficultyIndicator = document.getElementById('difficulty-indicator');
      const hellIndicator = document.getElementById('hell-indicator');
      const hardModeProgress = document.getElementById('hard-mode-progress');
      const targetsNeeded = document.getElementById('targets-needed');
      const hellTargetsNeeded = document.getElementById('hell-targets-needed');
      
      if (isHellMode) {
        // 地獄模式：隱藏困難模式UI，顯示地獄模式UI
        difficultyIndicator.classList.add('hidden');
        hellIndicator.classList.remove('hidden');
        hardModeProgress.classList.remove('hidden');
        hellTargetsNeeded.textContent = targetIndices.length;
        updateHardModeProgress();
      } else if (isHardMode) {
        // 困難模式：顯示困難模式UI，隱藏地獄模式UI
        difficultyIndicator.classList.remove('hidden');
        hellIndicator.classList.add('hidden');
        hardModeProgress.classList.remove('hidden');
        targetsNeeded.textContent = targetIndices.length;
        updateHardModeProgress();
      } else {
        // 普通模式：隱藏所有特殊模式UI
        difficultyIndicator.classList.add('hidden');
        hellIndicator.classList.add('hidden');
        hardModeProgress.classList.add('hidden');
      }

      const gameDiv = document.getElementById('game');
      gameDiv.innerHTML = '';
      const cols = round.tileCount === 6
        ? (window.innerWidth <= 600 ? 2 : 3)
        : (window.innerWidth <= 600 ? 3 : 5);
      gameDiv.style.setProperty('--cols', cols);

      const loadingIndicator = document.getElementById('loading-indicator');
      let hasLoadingImages = false;

      for (let i = 0; i < round.tileCount; i++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.setAttribute('tabindex', '0'); // 鍵盤可訪問性
        
        // 檢查圖片是否已在快取中
        const cachedImg = imageCache.get(round.tiles[i].path);
        if (cachedImg) {
          tile.style.backgroundImage = `url(${round.tiles[i].path})`;
        } else {
          // 如果圖片還沒載入，顯示載入中狀態
          tile.classList.add('loading');
          hasLoadingImages = true;
        }
        
        tile.addEventListener('click', () => handleClick(i, tile));
        tile.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            handleClick(i, tile);
          }
        });
        gameDiv.appendChild(tile);
      }

      // 顯示載入指示器
      if (hasLoadingImages) {
        loadingIndicator.classList.add('show');
      }

      // 當所有圖片載入完成後，更新瓦片背景
      round.loadPromise.then(() => {
        const tiles = gameDiv.querySelectorAll('.tile');
        tiles.forEach((tile, i) => {
          tile.style.backgroundImage = `url(${round.tiles[i].path})`;
          tile.classList.remove('loading');
        });
        loadingIndicator.classList.remove('show');
      }).catch(error => {
        console.error('Error loading images:', error);
        // 即使有錯誤也嘗試顯示圖片
        const tiles = gameDiv.querySelectorAll('.tile');
        tiles.forEach((tile, i) => {
          tile.style.backgroundImage = `url(${round.tiles[i].path})`;
          tile.classList.remove('loading');
        });
        loadingIndicator.classList.remove('show');
      });
    }

  function startRound() {
    if (!gameActive) return;
    ensurePreload();
    const round = preloadQueue.shift();
    if (!round) return; // 安全檢查
    
    renderRound(round);
    ensurePreload();
  }

  // 積極預載入下幾回合的圖片
  function aggressivePreload() {
    // 額外預載入一些常用圖片
    const commonImages = [];
    const types = ['muffin', 'chihuahua'];
    
    // 為每種類型預載入一些隨機圖片
    types.forEach(type => {
      const randomNums = getUniqueRandomNumbers(5, IMAGE_COUNTS[type]);
      randomNums.forEach(num => {
        const padded = String(num).padStart(digits, '0');
        commonImages.push(`${type}/${type}_${padded}.jpg`);
      });
    });
    
    // 開始預載入但不等待完成
    loadImagesAsync(commonImages).catch(error => {
      console.log('Background preload completed with some errors:', error);
    });
  }

  function showIntro() {
    ensurePreload();
    aggressivePreload(); // 在介紹畫面時開始積極預載入
    introClickable = false;
    introEl.classList.remove("hidden");
    introEl.classList.add("no-click");
    requestAnimationFrame(() => introEl.classList.add("show"));
    setTimeout(() => {
      introEl.classList.remove("no-click");
      introClickable = true;
    }, 1000);
  }

  function hideIntro() {
    introEl.classList.remove("show");
    introEl.classList.add("hidden");
  }

  function showAbout() {
    aboutEl.classList.remove("hidden");
    requestAnimationFrame(() => aboutEl.classList.add("show"));
  }

  function hideAbout() {
    aboutEl.classList.remove("show");
    aboutEl.classList.add("hidden");
    history.replaceState(null, "", "/");
  }

  function showContact() {
    contactEl.classList.remove("hidden");
    requestAnimationFrame(() => contactEl.classList.add("show"));
  }

  function hideContact() {
    contactEl.classList.remove("show");
    contactEl.classList.add("hidden");
    history.replaceState(null, "", "/");
  }

  function showPrivacy() {
    privacyEl.classList.remove("hidden");
    requestAnimationFrame(() => privacyEl.classList.add("show"));
  }

  function hidePrivacy() {
    privacyEl.classList.remove("show");
    privacyEl.classList.add("hidden");
    history.replaceState(null, "", "/");
  }

  function showTerms() {
    termsEl.classList.remove("hidden");
    requestAnimationFrame(() => termsEl.classList.add("show"));
  }

  function hideTerms() {
    termsEl.classList.remove("show");
    termsEl.classList.add("hidden");
    history.replaceState(null, "", "/");
  }

  function showHelp() {
    helpEl.classList.remove("hidden");
    requestAnimationFrame(() => helpEl.classList.add("show"));
  }

  function hideHelp() {
    helpEl.classList.remove("show");
    helpEl.classList.add("hidden");
    history.replaceState(null, "", "/");
  }

  function activateHardMode() {
    isHardMode = true;
    document.body.classList.add('hard-mode');
    preloadQueue.length = 0;
    ensurePreload();
    
    // Show hard mode activation message
    const msgEl = document.getElementById('message');
    msgEl.textContent = '🔥 Hard Mode ON! Find all targets!';
    msgEl.className = 'success';
    setTimeout(() => {
      msgEl.textContent = '';
      msgEl.className = '';
    }, 2000);
  }

  // 🔥 地獄模式激活函數
  function activateHellMode() {
    isHellMode = true;
    isHardMode = false; // 地獄模式覆蓋困難模式
    document.body.classList.remove('hard-mode');
    document.body.classList.add('hell-mode');
    preloadQueue.length = 0;
    ensurePreload();
    
    // 🔥 播放地獄模式音效
    sound.hellMode();
    
    // Show hell mode activation message with dramatic effect
    const msgEl = document.getElementById('message');
    msgEl.textContent = '💀 HELL MODE UNLEASHED! Find 3 targets!';
    msgEl.className = 'success';
    msgEl.style.color = 'var(--hell-mode-primary)';
    msgEl.style.fontWeight = '700';
    msgEl.style.textShadow = '0 2px 8px rgba(183, 28, 28, 0.8)';
    msgEl.style.animation = 'hell-pulse-glow 0.5s ease-in-out 3';
    
    setTimeout(() => {
      msgEl.textContent = '';
      msgEl.className = '';
      msgEl.style.color = '';
      msgEl.style.fontWeight = '';
      msgEl.style.textShadow = '';
      msgEl.style.animation = '';
    }, 3000);
  }

  function showReady(cb) {
      ensurePreload();
      readyEl.classList.remove("hidden");
      readyEl.textContent = "Ready";
      requestAnimationFrame(() => readyEl.classList.add("show"));
      setTimeout(() => {
        readyEl.textContent = "Start!";
        setTimeout(() => {
          readyEl.classList.remove("show");
          readyEl.classList.add("hidden");
          cb();
        }, 400);
      }, 600);
    }

  function startGame() {
      timeLeft = 30;
      score = 0;
      isHardMode = false;
      isHellMode = false; // 🔥 重置地獄模式
      document.body.classList.remove('hard-mode', 'hell-mode');
      
      // 🎨 重置主題系統
      document.body.classList.remove('theme-muffin', 'theme-chihuahua', 'theme-transition');
      
      gameActive = true;
      updateHUD();
      preloadQueue.length = 0;
      ensurePreload();
      summaryClickable = false;
      summaryEl.classList.remove("no-click");
      summaryEl.classList.remove("show");
      summaryEl.classList.add("hidden");
      
      // 🔥 隱藏所有特殊模式UI
      const difficultyIndicator = document.getElementById('difficulty-indicator');
      const hellIndicator = document.getElementById('hell-indicator');
      const hardModeProgress = document.getElementById('hard-mode-progress');
      difficultyIndicator.classList.add('hidden');
      hellIndicator.classList.add('hidden');
      hardModeProgress.classList.add('hidden');
      
      showReady(() => {
        sound.start();
        startRound();
        clearInterval(timerId);
        timerId = setInterval(() => {
          timeLeft--;
          updateHUD();
          if (timeLeft <= 0) {
            endGame();
          }
        }, 1000);
      });
    }

  function endGame() {
      if (!gameActive) return;
      sound.end();
      gameActive = false;
      clearInterval(timerId);
      document.getElementById('final-score').textContent = score;
      summaryClickable = false;
      summaryEl.classList.remove("hidden");
      summaryEl.classList.add("no-click");
      requestAnimationFrame(() => summaryEl.classList.add("show"));
      setTimeout(() => {
        summaryEl.classList.remove("no-click");
        summaryClickable = true;
      }, 2000);
    }

    function handleClick(index, tileEl) {
      if (!gameActive) return;
      const msgEl = document.getElementById('message');
      if (targetIndices.includes(index) && !tileEl.classList.contains('found')) {
        sound.correct();
        tileEl.classList.add('correct', 'correct-pulse');
        tileEl.classList.add('found');
        if (isHardMode) {
          tileEl.style.pointerEvents = 'none';
        }
        foundTargets++;
        
        // Update hard mode progress
        if (isHardMode) {
          updateHardModeProgress();
        }
        
        if (foundTargets === targetIndices.length) {
          score++;
          if (score === MEDIUM_MODE_THRESHOLD) {
            preloadQueue.length = 0;
            ensurePreload();
          }
          timeLeft += 2;
          updateHUD();
          
          if (isHardMode) {
            msgEl.textContent = `🎉 Great! Found all ${foundTargets} targets! +2s`;
          } else {
            msgEl.textContent = '🎉 Correct! +2s';
          }
          msgEl.className = 'success';
          showTimeChange(2);
          
          setTimeout(() => {
            if (!isHardMode) {
              tileEl.classList.remove('correct', 'correct-pulse');
              tileEl.classList.remove('found');
            } else {
              tileEl.style.pointerEvents = '';
              // keep highlight in hard mode
            }
            
            // 🔥 模式升級邏輯
            if (!isHellMode && score >= HELL_MODE_THRESHOLD) {
              activateHellMode();
            } else if (!isHardMode && !isHellMode && score >= HARD_MODE_THRESHOLD) {
              activateHardMode();
            }
            
            if (gameActive) startRound();
          }, 600);
        } else {
          if (isHardMode) {
            const remaining = targetIndices.length - foundTargets;
            msgEl.textContent = `✨ Good! Need ${remaining} more`;
          } else {
            msgEl.textContent = '✔️ One more!';
          }
          msgEl.className = 'success';
          setTimeout(() => {
            if (!isHardMode) {
              tileEl.classList.remove('correct', 'correct-pulse');
              tileEl.classList.remove('found');
            }
          }, 600);
        }
      } else {
        sound.wrong();
        timeLeft = Math.max(0, timeLeft - 2);
        updateHUD();
        
        if (isHardMode) {
          const remaining = targetIndices.length - foundTargets;
          msgEl.textContent = `❌ Wrong! Hint: Need ${remaining} more ${targetType}s -2s`;
        } else {
          msgEl.textContent = '❌ Wrong! -2s';
        }
        msgEl.className = 'error';
        showTimeChange(-2);
        tileEl.classList.add('wrong', 'error-shake');
        
        setTimeout(() => {
          tileEl.classList.remove('wrong', 'error-shake');
          msgEl.textContent = '';
          msgEl.className = '';
        }, 500);
        if (timeLeft <= 0) {
          endGame();
        }
      }
    }

    summaryEl.addEventListener("click", () => {
      if (summaryClickable) startGame();
    });

    introEl.addEventListener("click", () => {
      if (introClickable) {
        hideIntro();
        startGame();
      }
    });

    aboutEl.addEventListener("click", hideAbout);
    contactEl.addEventListener("click", hideContact);
    privacyEl.addEventListener("click", hidePrivacy);
    termsEl.addEventListener("click", hideTerms);
    helpEl.addEventListener("click", hideHelp);
    
    // 🍪 Cookie Consent (AdSense Requirement)
    function showCookieConsent() {
      if (!localStorage.getItem('muffind_cookie_consent')) {
        const cookieBar = document.createElement('div');
        cookieBar.innerHTML = `
          <div style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.95); color: white; padding: 15px; text-align: center; z-index: 10000; font-size: 0.9rem;">
            <p style="margin: 0 0 10px 0;">🍪 We use cookies to enhance your gaming experience and show relevant ads. By continuing to play, you consent to our use of cookies.</p>
            <button onclick="acceptCookies()" style="background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">Accept</button>
            <a href="?privacy" style="color: #ccc; text-decoration: underline;">Privacy Policy</a>
          </div>
        `;
        document.body.appendChild(cookieBar);
      }
    }
    
    function acceptCookies() {
      localStorage.setItem('muffind_cookie_consent', 'true');
      const cookieBar = document.querySelector('[style*="position: fixed; bottom: 0"]');
      if (cookieBar) cookieBar.remove();
    }
    
    // Make acceptCookies globally available
    window.acceptCookies = acceptCookies;
    function checkPage() {
      const params = new URLSearchParams(window.location.search);
      if (params.has("about")) {
        document.title = "About Us - Muffind";
        document.querySelector('meta[name="description"]').setAttribute('content', 'Learn about the passionate game development team behind Muffind, the viral muffin vs chihuahua recognition game.');
        showAbout();
      } else if (params.has("contact")) {
        document.title = "Contact Us - Muffind";
        document.querySelector('meta[name="description"]').setAttribute('content', 'Get in touch with the Muffind team. Email us at catfish1105@gmail.com for support or feedback.');
        showContact();
      } else if (params.has("privacy")) {
        document.title = "Privacy Policy - Muffind";
        document.querySelector('meta[name="description"]').setAttribute('content', 'Read our privacy policy to understand how Muffind protects your data and respects your privacy while you play.');
        showPrivacy();
      } else if (params.has("terms")) {
        document.title = "Terms of Service - Muffind";
        document.querySelector('meta[name="description"]').setAttribute('content', 'Review the terms of service for playing Muffind, the free online muffin vs chihuahua recognition game.');
        showTerms();
      } else if (params.has("help")) {
        document.title = "How to Play - Muffind";
        document.querySelector('meta[name="description"]').setAttribute('content', 'Learn how to play Muffind with tips, strategies, and detailed gameplay instructions for all difficulty modes.');
        showHelp();
      } else {
        showIntro();
      }
      
      // Ensure hard mode UI is hidden on page load
      const difficultyIndicator = document.getElementById('difficulty-indicator');
      const hardModeProgress = document.getElementById('hard-mode-progress');
      difficultyIndicator.classList.add('hidden');
      hardModeProgress.classList.add('hidden');
      
      // Show cookie consent if needed
      setTimeout(showCookieConsent, 1000);
    }

    window.onload = checkPage;
  </script>
</body>
</html>
